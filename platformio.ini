[platformio]
; Pick which env(s) run when you just do `pio run …`
default_envs = nucleo_f303k8_mbed

[env:nucleo_f303k8_stlink]          ; ← normal day-to-day (debuggable)
platform        = ststm32
board           = nucleo_f303k8
framework       = stm32cube
upload_protocol = stlink
debug_tool      = stlink
monitor_speed   = 115200
; Known-good OpenOCD build (optional but recommended)
platform_packages = platformio/tool-openocd@2.1100.211028
; Stable SWD speed for debugging
debug_speed     = 950

[env:nucleo_f303k8_recover]         ; ← use when OpenOCD can’t attach
extends        = env:nucleo_f303k8_stlink
; Force “connect under reset” once, then flash a good build
upload_flags =
  -c
  "reset_config srst_only srst_nogate connect_assert_srst"
; Safer/slower SWD for recovery
debug_speed    = 100

[env:nucleo_f303k8_mbed]            ; ← robust, quick flashing (no OpenOCD)
platform        = ststm32
board           = nucleo_f303k8
framework       = stm32cube
upload_protocol = mbed
monitor_speed   = 115200
extra_scripts = pre:format.py
; You can still debug with ST-Link when starting a debug session:
debug_tool      = stlink
build_flags =
  -Wl,-u,_printf_float
